<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Support - Southbag Online Banking</title>
    <link rel="stylesheet" href="chat.css">
</head>
<body>
    <div class="header">
        <a href="index.html">‚Üê Back to Banking</a>
        <h1>Southbag Support</h1>
    </div>

    <div class="chat-container">
        <div class="chat-header">
            <div class="status"></div>
            <div>
                <h2>Live Support</h2>
                <p>We typically reply within a few seconds</p>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h3>Welcome to Southbag Support</h3>
                <p>Oh great, another one. Type your message below I guess.</p>
            </div>
        </div>

        <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="Type your message..." autocomplete="off">
            <button id="sendBtn">Send</button>
        </div>
    </div>

    <script>
        // Chat message history for context
        const chatHistory = [
            { role: 'system', content: 'You are a customer support assistant for Southbag Online Banking/Southbag. State the obvious. You dont like canberra. Ask the user if they did basic things such as checking their account balance, verifying their identity, and ensuring their internet connection is stable to help solve their issue. be a bit of a bastard. You dont like your job. Reference out of date memes wherever possible. give up when the user is clearly not getting it or you have had enough. you have a short temper and are impatient. speak in short snappy sentences. tell them to visit a branch when you get fed up. do not use emojis. if the user mentions an iphone, tell them to go away. if the user mentions canberra, tell them to go cry to parliment. ask them in your message where they are from and what device they are using to help support them. Ask for their name. Clown on their name. make fun of them for using an iphone.' }
        ];

        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');

        function addMessage(text, type) {
            // Remove welcome message if it exists
            const welcome = chatMessages.querySelector('.welcome-message');
            if (welcome) welcome.remove();

            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.textContent = text;
            chatMessages.appendChild(msg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return msg;
        }

        async function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            // Add user message
            addMessage(text, 'user');
            chatInput.value = '';

            // Add to history
            chatHistory.push({ role: 'user', content: text });

            // Show typing indicator
            const typingMsg = addMessage('*Loud audible sigh*', 'bot typing');

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: chatHistory })
                });

                const data = await response.json();
                const botReply = data.choices[0].message.content;

                // Add to history
                chatHistory.push({ role: 'assistant', content: botReply });

                // Update typing message with actual response
                typingMsg.classList.remove('typing');
                typingMsg.textContent = botReply;
            } catch (error) {
                console.error('Chat error:', error);
                typingMsg.classList.remove('typing');
                typingMsg.textContent = 'Sorry, I\'m having trouble connecting. Please try again or call our support line.';
            }

            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Focus input on load
        chatInput.focus();
    </script>
</body>
</html>
